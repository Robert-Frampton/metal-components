define(["exports","metal/src/metal","metal-events/src/events"],function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0});var u=r(t),l=r(n),a=function(e){function t(n,r){o(this,t);var i=s(this,e.call(this));return i.component_=n,i.selector_=r||"*",i.handleKey_=i.handleKey_.bind(i),i}return i(t,e),t.prototype.buildRef_=function(e,t){return e+t},t.prototype.disposeInternal=function(){e.prototype.disposeInternal.call(this),this.stop(),this.component_=null,this.selector_=null},t.prototype.getNextFocusable_=function(e,t,n){var r=t,o=void 0,s=void 0;do t=this.increment_(t,n),s=this.buildRef_(e,t),o=this.component_.refs[s];while(this.isFocusable_(o)&&t!==r);return o?s:null},t.prototype.handleKey_=function(e){var n=this.focusHandler_&&this.focusHandler_(e);this.focusHandler_&&n!==!0||(n=this.handleKeyDefault_(e));var r=n;u["default"].isElement(n)||(n=this.component_.refs[n]),n&&(n.focus(),this.emit(t.EVENT_FOCUSED,{element:n,ref:u["default"].isString(r)?r:null}))},t.prototype.handleKeyDefault_=function(e){var n=e.delegateTarget.getAttribute("ref"),r=t.REF_REGEX.exec(n);if(r){var o=parseInt(r[1],10),s=n.substr(0,n.length-r[1].length);switch(e.keyCode){case 37:case 38:return this.getNextFocusable_(s,o,-1);case 39:case 40:return this.getNextFocusable_(s,o,1)}}},t.prototype.increment_=function(e,t){var n=this.circularLength_;return e+=t,u["default"].isNumber(n)&&(e<0?e=n-1:e>=n&&(e=0)),e},t.prototype.isFocusable_=function(e){return e&&"true"===e.getAttribute("data-unfocusable")},t.prototype.setCircularLength=function(e){return this.circularLength_=e,this},t.prototype.setFocusHandler=function(e){return this.focusHandler_=e,this},t.prototype.start=function(){return this.handle_||(this.handle_=this.component_.delegate("keydown",this.selector_,this.handleKey_)),this},t.prototype.stop=function(){return this.handle_&&(this.handle_.removeListener(),this.handle_=null),this},t}(l["default"]);a.EVENT_FOCUSED="focused",a.REF_REGEX=/.+-(\d+)$/,e["default"]=a});