define(["exports","metal/src/metal","metal-events/src/events","metal-state/src/all/state"],function(t,e,n,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0});var u=a(r),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=function p(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:p(a,e,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},f=function(t){function r(t,n){o(this,r);var a=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return a.component_=t,e.core.mergeSuperClassesProperty(a.constructor,"BLACKLIST",e.array.firstDefinedValue),u["default"].mergeStateStatic(a.component_.constructor),a.createState_(n,a.component_),a}return s(r,t),c(r,[{key:"add",value:function(){var t;(t=this.state_).addToState.apply(t,arguments)}},{key:"buildStateInstanceData_",value:function(t){return e.object.mixin({},t,this.component_.constructor.STATE_MERGED)}},{key:"createState_",value:function(t,e){var r=new u["default"]({},e,this.component_);r.setKeysBlacklist_(this.constructor.BLACKLIST_MERGED),r.addToState(this.buildStateInstanceData_(t),this.component_.getInitialConfig());var a=this.emit_.bind(this);r.on("stateChanged",a),r.on("stateKeyChanged",a),this.state_=r,this.proxy_=new n.EventEmitterProxy(r,this.component_)}},{key:"disposeInternal",value:function(){l(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"disposeInternal",this).call(this),this.state_.dispose(),this.state_=null,this.proxy_.dispose(),this.proxy_=null}},{key:"emit_",value:function(t,e){var n=e.type,r="stateChanged"===n?"dataChanged":"dataPropChanged";this.emit(r,t)}},{key:"get",value:function(t){return this.state_.get(t)}},{key:"getSyncKeys",value:function(){return this.state_.getStateKeys()}},{key:"getStateKeys",value:function(){return this.state_.getStateKeys()}},{key:"getState",value:function(){return this.state_.getState()}},{key:"getStateInstance",value:function(){return this.state_}},{key:"replaceNonInternal",value:function(t){r.replaceNonInternal(t,this.state_)}},{key:"setState",value:function(t,e){this.state_.setState(t,e)}}],[{key:"replaceNonInternal",value:function(t,e){for(var n=e.getStateKeys(),r=0;r<n.length;r++){var a=n[r];e.getStateKeyConfig(a).internal||(t.hasOwnProperty(a)?e.set(a,t[a]):e.setDefaultValue(a))}}}]),r}(n.EventEmitter);f.BLACKLIST={components:!0,context:!0,element:!0,refs:!0,wasRendered:!0},t["default"]=f});