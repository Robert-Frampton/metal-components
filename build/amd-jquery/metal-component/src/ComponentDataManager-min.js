define(["exports","metal/src/metal","metal-events/src/events","metal-state/src/all/state"],function(t,e,n,o){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0});var c=r(o),p=function(t){function o(n,r){a(this,o);var i=s(this,t.call(this));return i.component_=n,e.core.mergeSuperClassesProperty(i.constructor,"BLACKLIST",e.array.firstDefinedValue),c["default"].mergeStateStatic(i.component_.constructor),i.createState_(r,i.component_),i}return i(o,t),o.prototype.add=function(){var t;(t=this.state_).addToState.apply(t,arguments)},o.prototype.buildStateInstanceData_=function(t){return e.object.mixin({},t,this.component_.constructor.STATE_MERGED)},o.prototype.createState_=function(t,e){var o=new c["default"]({},e,this.component_);o.setKeysBlacklist_(this.constructor.BLACKLIST_MERGED),o.addToState(this.buildStateInstanceData_(t),this.component_.getInitialConfig());var r=this.emit_.bind(this);o.on("stateChanged",r),o.on("stateKeyChanged",r),this.state_=o,this.proxy_=new n.EventEmitterProxy(o,this.component_)},o.prototype.disposeInternal=function(){t.prototype.disposeInternal.call(this),this.state_.dispose(),this.state_=null,this.proxy_.dispose(),this.proxy_=null},o.prototype.emit_=function(t,e){var n=e.type,o="stateChanged"===n?"dataChanged":"dataPropChanged";this.emit(o,t)},o.prototype.get=function(t){return this.state_.get(t)},o.prototype.getSyncKeys=function(){return this.state_.getStateKeys()},o.prototype.getStateKeys=function(){return this.state_.getStateKeys()},o.prototype.getState=function(){return this.state_.getState()},o.prototype.getStateInstance=function(){return this.state_},o.prototype.replaceNonInternal=function(t){o.replaceNonInternal(t,this.state_)},o.replaceNonInternal=function(t,e){for(var n=e.getStateKeys(),o=0;o<n.length;o++){var r=n[o];e.getStateKeyConfig(r).internal||(t.hasOwnProperty(r)?e.set(r,t[r]):e.setDefaultValue(r))}},o.prototype.setState=function(t,e){this.state_.setState(t,e)},o}(n.EventEmitter);p.BLACKLIST={components:!0,element:!0,wasRendered:!0},t["default"]=p});