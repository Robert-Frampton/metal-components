define(["exports","metal/src/metal","metal-events/src/events"],function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0});var l=r(t),a=r(n),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:h(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},f=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.component_=e,r.selector_=n||"*",r.handleKey_=r.handleKey_.bind(r),r}return u(t,e),s(t,[{key:"buildRef_",value:function(e,t){return e+t}},{key:"disposeInternal",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disposeInternal",this).call(this),this.stop(),this.component_=null,this.selector_=null}},{key:"getNextFocusable_",value:function(e,t,n){var r=t,o=void 0,i=void 0;do t=this.increment_(t,n),i=this.buildRef_(e,t),o=this.component_.refs[i];while(this.isFocusable_(o)&&t!==r);return o?i:null}},{key:"handleKey_",value:function(e){var n=this.focusHandler_&&this.focusHandler_(e);this.focusHandler_&&n!==!0||(n=this.handleKeyDefault_(e));var r=n;l["default"].isElement(n)||(n=this.component_.refs[n]),n&&(n.focus(),this.emit(t.EVENT_FOCUSED,{element:n,ref:l["default"].isString(r)?r:null}))}},{key:"handleKeyDefault_",value:function(e){var n=e.delegateTarget.getAttribute("ref"),r=t.REF_REGEX.exec(n);if(r){var o=parseInt(r[1],10),i=n.substr(0,n.length-r[1].length);switch(e.keyCode){case 37:case 38:return this.getNextFocusable_(i,o,-1);case 39:case 40:return this.getNextFocusable_(i,o,1)}}}},{key:"increment_",value:function(e,t){var n=this.circularLength_;return e+=t,l["default"].isNumber(n)&&(e<0?e=n-1:e>=n&&(e=0)),e}},{key:"isFocusable_",value:function(e){return e&&"true"===e.getAttribute("data-unfocusable")}},{key:"setCircularLength",value:function(e){return this.circularLength_=e,this}},{key:"setFocusHandler",value:function(e){return this.focusHandler_=e,this}},{key:"start",value:function(){return this.handle_||(this.handle_=this.component_.delegate("keydown",this.selector_,this.handleKey_)),this}},{key:"stop",value:function(){return this.handle_&&(this.handle_.removeListener(),this.handle_=null),this}}]),t}(a["default"]);f.EVENT_FOCUSED="focused",f.REF_REGEX=/.+-(\d+)$/,e["default"]=f});