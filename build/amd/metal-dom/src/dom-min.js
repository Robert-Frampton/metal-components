define(["exports","metal/src/metal","./domData","./DomDelegatedEventHandle","./DomEventHandle"],function(e,t,n,r,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=a(n),l=a(r),c=a(i),u="__metal_next_target__",d={blur:!0,error:!0,focus:!0,invalid:!0,load:!0,scroll:!0},f=function(){function e(){o(this,e)}return e.addClasses=function(n,r){if(t.core.isObject(n)&&t.core.isString(r)){n.length||(n=[n]);for(var i=0;i<n.length;i++)"classList"in n[i]?e.addClassesWithNative_(n[i],r):e.addClassesWithoutNative_(n[i],r)}},e.addClassesWithNative_=function(e,t){t.split(" ").forEach(function(t){t&&e.classList.add(t)})},e.addClassesWithoutNative_=function(e,t){var n=" "+e.className+" ",r="";t=t.split(" ");for(var i=0;i<t.length;i++){var a=t[i];n.indexOf(" "+a+" ")===-1&&(r+=" "+a)}r&&(e.className=e.className+r)},e.addElementListener_=function(t,n,r){var i=s["default"].get(t);e.addToArr_(i.listeners,n,r)},e.addSelectorListener_=function(t,n,r,i){var a=s["default"].get(t);e.addToArr_(a.delegating[n].selectors,r,i)},e.addToArr_=function(e,t,n){e[t]||(e[t]=[]),e[t].push(n)},e.attachDelegateEvent_=function(t,n){var r=s["default"].get(t);r.delegating[n]||(r.delegating[n]={handle:e.on(t,n,e.handleDelegateEvent_,!!d[n]),selectors:{}})},e.closest=function(t,n){for(;t&&!e.match(t,n);)t=t.parentNode;return t},e.append=function(n,r){if(t.core.isString(r)&&(r=e.buildFragment(r)),r instanceof NodeList)for(var i=Array.prototype.slice.call(r),a=0;a<i.length;a++)n.appendChild(i[a]);else n.appendChild(r);return r},e.buildFragment=function(e){var t=document.createElement("div");t.innerHTML="<br>"+e,t.removeChild(t.firstChild);for(var n=document.createDocumentFragment();t.firstChild;)n.appendChild(t.firstChild);return n},e.contains=function(e,n){return t.core.isDocument(e)?e.documentElement.contains(n):e.contains(n)},e.delegate=function(n,r,i,a,o){var s=e.customEvents[r];return s&&s.delegate&&(r=s.originalEvent,a=s.handler.bind(s,a)),o&&(a=a.bind(),a.defaultListener_=!0),e.attachDelegateEvent_(n,r),t.core.isString(i)?e.addSelectorListener_(n,r,i,a):e.addElementListener_(i,r,a),new l["default"](t.core.isString(i)?n:i,r,a,t.core.isString(i)?i:null)},e.isAbleToInteractWith_=function(t,n){var r=t,i=!0,a="button, input, select, textarea, fieldset";if("click"===n)for(;r;){if(r.disabled&&e.match(r,a)){i=!1;break}r=r.parentNode}return i},e.enterDocument=function(t){t&&e.append(document.body,t)},e.exitDocument=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},e.handleDelegateEvent_=function(n){e.normalizeDelegateEvent_(n);for(var r=t.core.isDef(n[u])?n[u]:n.target,i=!0,a=n.currentTarget,o=n.currentTarget.parentNode,s=[];r&&r!==o&&!n.stopped;)n.delegateTarget=r,i&=e.triggerMatchedListeners_(a,r,n,s),r=r.parentNode;for(var l=0;l<s.length&&!n.defaultPrevented;l++)n.delegateTarget=s[l].element,i&=s[l].fn(n);return n.delegateTarget=null,n[u]=o,i},e.hasClass=function(t,n){return"classList"in t?e.hasClassWithNative_(t,n):e.hasClassWithoutNative_(t,n)},e.hasClassWithNative_=function(e,t){return e.classList.contains(t)},e.hasClassWithoutNative_=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>=0},e.isEmpty=function(e){return 0===e.childNodes.length},e.match=function(t,n){if(!t||1!==t.nodeType)return!1;var r=Element.prototype,i=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector;return i?i.call(t,n):e.matchFallback_(t,n)},e.matchFallback_=function(e,t){for(var n=document.querySelectorAll(t,e.parentNode),r=0;r<n.length;++r)if(n[r]===e)return!0;return!1},e.next=function(t,n){do if(t=t.nextSibling,t&&e.match(t,n))return t;while(t);return null},e.normalizeDelegateEvent_=function(t){t.stopPropagation=e.stopPropagation_,t.stopImmediatePropagation=e.stopImmediatePropagation_},e.on=function(n,r,i,a){if(t.core.isString(n))return e.delegate(document,r,n,i);var o=e.customEvents[r];return o&&o.event&&(r=o.originalEvent,i=o.handler.bind(o,i)),n.addEventListener(r,i,a),new c["default"](n,r,i,a)},e.once=function(e,t,n){var r=this.on(e,t,function(){return r.removeListener(),n.apply(this,arguments)});return r},e.parent=function(t,n){return e.closest(t.parentNode,n)},e.registerCustomEvent=function(t,n){e.customEvents[t]=n},e.removeChildren=function(e){for(var t;t=e.firstChild;)e.removeChild(t)},e.removeClasses=function(n,r){if(t.core.isObject(n)&&t.core.isString(r)){n.length||(n=[n]);for(var i=0;i<n.length;i++)"classList"in n[i]?e.removeClassesWithNative_(n[i],r):e.removeClassesWithoutNative_(n[i],r)}},e.removeClassesWithNative_=function(e,t){t.split(" ").forEach(function(t){t&&e.classList.remove(t)})},e.removeClassesWithoutNative_=function(e,t){var n=" "+e.className+" ";t=t.split(" ");for(var r=0;r<t.length;r++)n=n.replace(" "+t[r]+" "," ");e.className=n.trim()},e.replace=function(e,t){e&&t&&e!==t&&e.parentNode&&(e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e))},e.stopImmediatePropagation_=function(){this.stopped=!0,this.stoppedImmediate=!0,Event.prototype.stopImmediatePropagation.call(this)},e.stopPropagation_=function(){this.stopped=!0,Event.prototype.stopPropagation.call(this)},e.supportsEvent=function(n,r){return!!e.customEvents[r]||(t.core.isString(n)&&(g[n]||(g[n]=document.createElement(n)),n=g[n]),"on"+r in n)},e.toElement=function(e){return t.core.isElement(e)||t.core.isDocument(e)?e:t.core.isString(e)?"#"===e[0]&&e.indexOf(" ")===-1?document.getElementById(e.substr(1)):document.querySelector(e):null},e.toggleClasses=function(n,r){t.core.isObject(n)&&t.core.isString(r)&&("classList"in n?e.toggleClassesWithNative_(n,r):e.toggleClassesWithoutNative_(n,r))},e.toggleClassesWithNative_=function(e,t){t.split(" ").forEach(function(t){e.classList.toggle(t)})},e.toggleClassesWithoutNative_=function(e,t){var n=" "+e.className+" ";t=t.split(" ");for(var r=0;r<t.length;r++){var i=" "+t[r]+" ",a=n.indexOf(i);n=a===-1?n+t[r]+" ":n.substring(0,a)+" "+n.substring(a+i.length)}e.className=n.trim()},e.triggerEvent=function(n,r,i){if(e.isAbleToInteractWith_(n,r)){var a=document.createEvent("HTMLEvents");a.initEvent(r,!0,!0),t.object.mixin(a,i),n.dispatchEvent(a)}},e.triggerListeners_=function(e,t,n,r){var i=!0;e=e||[];for(var a=0;a<e.length&&!t.stoppedImmediate;a++)e[a].defaultListener_?r.push({element:n,fn:e[a]}):i&=e[a](t);return i},e.triggerMatchedListeners_=function(t,n,r,i){if("click"!==r.type||2!==r.button){for(var a=s["default"].get(n),o=a.listeners[r.type],l=e.triggerListeners_(o,r,n,i),c=s["default"].get(t).delegating[r.type].selectors,u=Object.keys(c),d=0;d<u.length&&!r.stoppedImmediate;d++)e.match(n,u[d])&&(o=c[u[d]],l&=e.triggerListeners_(o,r,n,i));return l}},e}(),g={};f.customEvents={},e["default"]=f});