{"version":3,"sources":["Autocomplete.js"],"names":["Autocomplete","eventHandler_","add","on","inputElement","handleInputFocus_","bind","document","handleDocClick_","window","handleWindowResize_","visible","align","element","style","width","offsetWidth","position","Bottom","removeClasses","positionCss_","Top","TopLeft","TopRight","BottomLeft","BottomRight","addClasses","components","list","event","stopPropagation","activeElement","request","value","query","autocompleteClosing_","self","then","data","forEach","assertItemObjectStructure_","getList","items","length","item","selectedIndex","parseInt","getAttribute","emit","isObject","CancellationError","hasOwnProperty","register","STATE","format","isString","textPrimary","text"],"mappings":"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","file":"node_modules/metal-autocomplete/src/Autocomplete.js","sourcesContent":["'use strict';\n\nimport core from 'metal';\nimport debounce from 'metal-debounce';\nimport dom from 'metal-dom';\nimport { CancellablePromise as Promise } from 'metal-promise';\nimport { Align } from 'metal-position';\nimport AutocompleteBase from './AutocompleteBase';\nimport Soy from 'metal-soy';\n\nimport 'metal-list';\nimport templates from './Autocomplete.soy.js';\n\n/*\n * Autocomplete component.\n */\nclass Autocomplete extends AutocompleteBase {\n\t/**\n\t * @inheritDoc\n\t */\n\tattached() {\n\t\tsuper.attached();\n\t\tthis.eventHandler_.add(dom.on(this.inputElement, 'focus', this.handleInputFocus_.bind(this)));\n\t\tthis.eventHandler_.add(dom.on(document, 'click', this.handleDocClick_.bind(this)));\n\t\tthis.eventHandler_.add(dom.on(window, 'resize', debounce(this.handleWindowResize_.bind(this), 100)));\n\t\tif (this.visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * Aligns main element to the input element.\n\t */\n\talign() {\n\t\tthis.element.style.width = this.inputElement.offsetWidth + 'px';\n\t\tvar position = Align.align(this.element, this.inputElement, Align.Bottom);\n\n\t\tdom.removeClasses(this.element, this.positionCss_);\n\t\tswitch (position) {\n\t\t\tcase Align.Top:\n\t\t\tcase Align.TopLeft:\n\t\t\tcase Align.TopRight:\n\t\t\t\tthis.positionCss_ = 'autocomplete-top';\n\t\t\t\tbreak;\n\t\t\tcase Align.Bottom:\n\t\t\tcase Align.BottomLeft:\n\t\t\tcase Align.BottomRight:\n\t\t\t\tthis.positionCss_ = 'autocomplete-bottom';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.positionCss_ = null;\n\n\t\t}\n\t\tdom.addClasses(this.element, this.positionCss_);\n\t}\n\n\t/**\n\t * Returns the `List` component being used to render the matched items.\n\t * @return {!List}\n\t */\n\tgetList() {\n\t\treturn this.components.list;\n\t}\n\n\t/**\n\t * Handles `click` events, stopping their propagation.\n\t * @param {!Event} event\n\t * @protected\n\t */\n\thandleClick_(event) {\n\t\tevent.stopPropagation();\n\t}\n\n\t/**\n\t * Handles document click in order to hide autocomplete. If input element is\n\t * focused autocomplete will not hide.\n\t * @param {!Event} event\n\t */\n\thandleDocClick_() {\n\t\tif (document.activeElement === this.inputElement) {\n\t\t\treturn;\n\t\t}\n\t\tthis.visible = false;\n\t}\n\n\t/**\n\t * Handles input focus.\n\t * @param {!Event} event\n\t */\n\thandleInputFocus_() {\n\t\tthis.request(this.inputElement.value);\n\t}\n\n\t/**\n\t * Handles window resize events. Realigns the autocomplete results list to\n\t * the input field.\n\t */\n\thandleWindowResize_() {\n\t\tif (this.visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trequest(query) {\n\t\tif (this.autocompleteClosing_) {\n\t\t\t// While closing the input element will be focused, causing another\n\t\t\t// request. This request should be ignored though, since we wish to close\n\t\t\t// the dropdown list, not open it again.\n\t\t\treturn;\n\t\t}\n\n\t\tvar self = this;\n\t\treturn super.request(query).then(function(data) {\n\t\t\tif (data) {\n\t\t\t\tdata.forEach(self.assertItemObjectStructure_);\n\t\t\t\tself.getList().items = data;\n\t\t\t}\n\t\t\tself.visible = !!(data && data.length > 0);\n\t\t});\n\t}\n\n\t/**\n\t * Emits a `select` event with the information about the selected item and\n\t * hides the element.\n\t * @param {!Element} item The list selected item.\n\t * @protected\n\t */\n\tonListItemSelected_(item) {\n\t\tvar selectedIndex = parseInt(item.getAttribute('data-index'), 10);\n\t\tthis.autocompleteClosing_ = true;\n\t\tthis.emit('select', this.getList().items[selectedIndex]);\n\t\tthis.visible = false;\n\t\tthis.autocompleteClosing_ = false;\n\t}\n\n\t/**\n\t * Synchronization logic for `visible` state.\n\t * @param {boolean} visible\n\t */\n\tsyncVisible(visible) {\n\t\tsuper.syncVisible(visible);\n\n\t\tif (visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * Asserts that formatted data is valid. Throws error if item is not in the\n\t * valid syntax.\n\t * @param {*} item\n\t * @protected\n\t */\n\tassertItemObjectStructure_(item) {\n\t\tif (!core.isObject(item)) {\n\t\t\tthrow new Promise.CancellationError('Autocomplete item must be an object');\n\t\t}\n\t\tif (!item.hasOwnProperty('textPrimary')) {\n\t\t\tthrow new Promise.CancellationError('Autocomplete item must be an object with \\'textPrimary\\' key');\n\t\t}\n\t}\n}\nSoy.register(Autocomplete, templates);\n\n/**\n * State definition.\n * @type {!Object}\n * @static\n */\nAutocomplete.STATE = {\n\t/**\n\t * Function that converts a given item to the format that should be used by\n\t * the autocomplete.\n\t * @type {!function()}\n\t */\n\tformat: {\n\t\tvalue: function(item) {\n\t\t\tif (core.isString(item)) {\n\t\t\t\titem = {\n\t\t\t\t\ttextPrimary: item\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (core.isObject(item) && !item.text) {\n\t\t\t\titem.text = item.textPrimary;\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\t}\n};\n\nexport default Autocomplete;\n"],"sourceRoot":"/source/"}