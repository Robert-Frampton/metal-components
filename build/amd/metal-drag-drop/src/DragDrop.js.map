{"version":3,"sources":["DragDrop.js"],"names":["DragDrop","opt_config","activeTargets_","target","targets","push","obj","allActiveTargets","forEach","removeAttribute","length","removeClasses","targetOverClass","activeTargets","mainRegion","sourceRegion","getSourceRegion_","index","region","getRegion","activeDragPlaceholder_","intersectRegion","insideRegion","concat","bind","isDefAndNotNull","mousePos_","x","y","makeRegion","mixin","sourceRegion_","left","document","body","scrollLeft","right","top","scrollTop","bottom","data","event","prevTargetsSelector_","remove","val","isString","toElements_","ariaDropEffect","setAttribute","deltaX","deltaY","newTargets","findAllActiveTargets_","emit","Events","TARGET_LEAVE","buildEventObject_","addClasses","TARGET_ENTER","STATE","validator","value","setter","DRAG","END"],"mappings":"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","file":"node_modules/metal-drag-drop/src/DragDrop.js","sourcesContent":["'use strict';\n\nimport { array, core, object } from 'metal';\nimport dom from 'metal-dom';\nimport Drag from './Drag';\nimport Position from 'metal-position';\nimport 'metal-events';\n\n/**\n * Adds the functionality of dropping dragged elements to specific\n * targets to the `Drag` class.\n * @extends {Drag}\n */\nclass DragDrop extends Drag {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(opt_config) {\n\t\tsuper(opt_config);\n\n\t\t/**\n\t\t * The currently active targets, that is, the ones that the dragged source is over.\n\t\t * @type {!Array<!Element>}\n\t\t * @protected\n\t\t */\n\t\tthis.activeTargets_ = [];\n\t}\n\n\t/**\n\t * Adds a target to this `DragDrop` instance.\n\t * @param {!Element} target\n\t */\n\taddTarget(target) {\n\t\tthis.targets.push(target);\n\t\tthis.targets = this.targets;\n\t}\n\n\t/**\n\t * Overrides the original method from `Drag` to include the target on the event object.\n\t * @return {!Object}\n\t * @protected\n\t * @override\n\t */\n\tbuildEventObject_() {\n\t\tvar obj = super.buildEventObject_();\n\t\tobj.target = this.activeTargets_[0];\n\t\tobj.allActiveTargets = this.activeTargets_;\n\t\treturn obj;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tcleanUpAfterDragging_() {\n\t\tsuper.cleanUpAfterDragging_();\n\t\tthis.targets.forEach(target => target.removeAttribute('aria-dropeffect'));\n\t\tif (this.activeTargets_.length) {\n\t\t\tdom.removeClasses(this.activeTargets_[0], this.targetOverClass);\n\t\t}\n\t\tthis.activeTargets_ = [];\n\t}\n\n\t/**\n\t * Finds all targets that the dragged element is currently over.\n\t * @return {!Array<!Element>} The current active targets.\n\t * @protected\n\t */\n\tfindAllActiveTargets_() {\n\t\tvar activeTargets = [];\n\t\tvar mainRegion;\n\t\tvar sourceRegion = this.getSourceRegion_();\n\t\tvar targets = this.targets;\n\t\ttargets.forEach(function(target, index) {\n\t\t\tvar region = Position.getRegion(target);\n\t\t\tif (targets[index] !== this.activeDragPlaceholder_ && Position.intersectRegion(region, sourceRegion)) {\n\t\t\t\tif (!mainRegion || Position.insideRegion(mainRegion, region)) {\n\t\t\t\t\tactiveTargets = [targets[index]].concat(activeTargets);\n\t\t\t\t\tmainRegion = region;\n\t\t\t\t} else {\n\t\t\t\t\tactiveTargets.push(targets[index]);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn activeTargets;\n\t}\n\n\t/**\n\t * Gets the active source's region, to be used when calculating which targets are active.\n\t * @return {!Object}\n\t * @protected\n\t */\n\tgetSourceRegion_() {\n\t\tif (core.isDefAndNotNull(this.mousePos_)) {\n\t\t\tvar x = this.mousePos_.x;\n\t\t\tvar y = this.mousePos_.y;\n\t\t\treturn Position.makeRegion(y, 0, x, x, y, 0);\n\t\t} else {\n\t\t\t// We need to remove the scroll data from the region, since the other regions we'll\n\t\t\t// be comparing to won't take that information into account.\n\t\t\tvar region = object.mixin({}, this.sourceRegion_);\n\t\t\tregion.left -= document.body.scrollLeft;\n\t\t\tregion.right -= document.body.scrollLeft;\n\t\t\tregion.top -= document.body.scrollTop;\n\t\t\tregion.bottom -= document.body.scrollTop;\n\t\t\treturn region;\n\t\t}\n\t}\n\n\t/**\n\t * Triggers when the `container` state changes. Overrides default method so\n\t * it will also update `targets` when container changes.\n\t * @param {!Object} data\n\t * @param {!Object} event\n\t * @protected\n\t */\n\thandleContainerChanged_(data, event) {\n\t\tsuper.handleContainerChanged_(data, event);\n\t\tif (this.prevTargetsSelector_) {\n\t\t\tthis.targets = this.prevTargetsSelector_;\n\t\t}\n\t}\n\n\t/**\n\t * Removes a target from this `DragDrop` instance.\n\t * @param {!Element} target\n\t */\n\tremoveTarget(target) {\n\t\tarray.remove(this.targets, target);\n\t\tthis.targets = this.targets;\n\t}\n\n\t/**\n\t * Sets the `targets` state property.\n\t * @param {Element|string} val\n\t * @return {!Array<!Element>}\n\t * @protected\n\t */\n\tsetterTargetsFn_(val) {\n\t\tthis.prevTargetsSelector_ = core.isString(val) ? val : null;\n\t\treturn this.toElements_(val);\n\t}\n\n\t/**\n\t * Overrides the original method from `Drag` to also set the \"aria-dropeffect\"\n\t * attribute, if set, for all targets.\n\t * @return {[type]} [description]\n\t */\n\tstartDragging_() {\n\t\tif (this.ariaDropEffect) {\n\t\t\tthis.targets.forEach(target => target.setAttribute('aria-dropeffect', this.ariaDropEffect));\n\t\t}\n\t\tsuper.startDragging_();\n\t}\n\n\t/**\n\t * Overrides original method from `Drag` to also be enable finding the target\n\t * the dragged element is over at the new position.\n\t * @param {number} deltaX\n\t * @param {number} deltaY\n\t * @override\n\t */\n\tupdatePosition(deltaX, deltaY) {\n\t\tsuper.updatePosition(deltaX, deltaY);\n\n\t\tvar newTargets = this.findAllActiveTargets_();\n\t\tif (newTargets[0] !== this.activeTargets_[0]) {\n\t\t\tif (this.activeTargets_[0]) {\n\t\t\t\tdom.removeClasses(this.activeTargets_[0], this.targetOverClass);\n\t\t\t\tthis.emit(DragDrop.Events.TARGET_LEAVE, this.buildEventObject_());\n\t\t\t}\n\n\t\t\tthis.activeTargets_ = newTargets;\n\t\t\tif (this.activeTargets_[0]) {\n\t\t\t\tdom.addClasses(this.activeTargets_[0], this.targetOverClass);\n\t\t\t\tthis.emit(DragDrop.Events.TARGET_ENTER, this.buildEventObject_());\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * State definition.\n * @type {!Object}\n * @static\n */\nDragDrop.STATE = {\n\t/**\n\t * The \"aria-dropeffect\" value to be set for all targets. If not set,\n\t * this html attribute will have to be set manually on the targets.\n\t * @type {string}\n\t */\n\tariaDropEffect: {\n\t\tvalidator: core.isString\n\t},\n\n\t/**\n\t * The CSS class that should be added to drop targets when a source\n\t * is being dragged over them.\n\t * @type {string}\n\t * @default 'dropOver'\n\t */\n\ttargetOverClass: {\n\t\tvalidator: core.isString,\n\t\tvalue: 'targetOver'\n\t},\n\n\t/**\n\t * Elements that the sources can be dropped on. Can be either a single\n\t * element or a selector for multiple elements.\n\t * @type {!Element|string}\n\t */\n\ttargets: {\n\t\tsetter: 'setterTargetsFn_',\n\t\tvalidator: 'validateElementOrString_'\n\t}\n};\n\n/**\n * Holds the names of events that can be emitted by `DragDrop`.\n * @type {!Object}\n * @static\n */\nDragDrop.Events = {\n\tDRAG: 'drag',\n\tEND: 'end',\n\tTARGET_ENTER: 'targetEnter',\n\tTARGET_LEAVE: 'targetLeave'\n};\n\nexport default DragDrop;\n"],"sourceRoot":"/source/"}