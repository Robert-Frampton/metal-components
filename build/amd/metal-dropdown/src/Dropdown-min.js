define(["exports","metal/src/metal","metal-dom/src/all/dom","metal-position/src/all/position","metal-component/src/all/component","metal-events/src/events","metal-soy/src/Soy","./Dropdown.soy.js"],function(e,t,n,o,i,r,l,a){"use strict";function u(e){return e&&e.__esModule?e:{"default":e}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0});var f=u(n),v=u(i),h=u(l),y=u(a),m=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),g=function b(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:b(i,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},_=function(e){function n(){return c(this,n),d(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return p(n,e),m(n,[{key:"attached",value:function(){g(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"attached",this).call(this),this.eventHandler_.add(f["default"].on(document,"click",this.handleDocClick_.bind(this)))}},{key:"created",value:function(){this.eventHandler_=new r.EventHandler}},{key:"detached",value:function(){g(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"detached",this).call(this),this.eventHandler_.removeAllListeners()}},{key:"close",value:function(){this.expanded=!1}},{key:"isOpen",value:function(){return this.expanded}},{key:"handleDocClick_",value:function(e){this.element.contains(e.target)||this.close()}},{key:"open",value:function(){this.expanded=!0}},{key:"setterClassMapFn_",value:function(e){return t.object.mixin(this.valueClassMapFn_(),e)}},{key:"setterPositionFn_",value:function(e){return t.core.isNumber(e)?e:"up"===e.toLowerCase()?o.Align.TopLeft:o.Align.BottomLeft}},{key:"syncExpanded",value:function(e){if(e&&this.alignElementSelector){var t=this.element.querySelector(this.alignElementSelector);if(t){var n=this.element.querySelector(".dropdown-menu");this.alignedPosition=o.Align.align(n,t,this.position)}}}},{key:"toggle",value:function(){this.expanded=!this.expanded}},{key:"validatePosition_",value:function(e){if(o.Align.isValidPosition(e))return!0;switch(e.toLowerCase()){case"up":case"down":return!0;default:return!1}}},{key:"valueBodyFn_",value:function(){var e=this.element&&this.element.querySelector(".dropdown-menu");return e?e.innerHTML:""}},{key:"valueClassMapFn_",value:function(){var e;return e={},s(e,o.Align.TopLeft,"dropup"),s(e,o.Align.TopCenter,"dropup"),s(e,o.Align.TopRight,"dropup"),s(e,o.Align.BottomLeft,"dropdown"),s(e,o.Align.BottomCenter,"dropdown"),s(e,o.Align.BottomRight,"dropdown"),s(e,o.Align.RightCenter,"dropright"),s(e,o.Align.LeftCenter,"dropleft"),e}},{key:"valueHeaderFn_",value:function(){if(this.element){for(var e=document.createElement("div"),t=0;t<this.element.childNodes.length&&!f["default"].hasClass(this.element.childNodes[t],"dropdown-menu");t++)e.appendChild(this.element.childNodes[t].cloneNode(!0));return e.innerHTML}return""}}]),n}(v["default"]);h["default"].register(_,y["default"]),_.STATE={alignedPosition:{validator:o.Align.isValidPosition},alignElementSelector:{validator:t.core.isString},body:{isHtml:!0,valueFn:"valueBodyFn_"},classMap:{setter:"setterClassMapFn_",validator:t.core.isObject,valueFn:"valueClassMapFn_"},header:{isHtml:!0,valueFn:"valueHeaderFn_"},expanded:{value:!1},position:{setter:"setterPositionFn_",value:o.Align.BottomLeft,validator:"validatePosition_"},positionClassOnMenu:{value:!1}},e["default"]=_});